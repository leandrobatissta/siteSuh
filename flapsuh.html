<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Flap Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
            font-family: Arial, sans-serif;
        }
        canvas {
            background: white;
        }
        #message, #instructions {
            position: absolute;
            font-size: 28px;
            text-align: center;
            color: black;
            width: 100%;
        }
        #message {
            top: 50%;
            transform: translateY(-50%);
        }
        #instructions {
            top: 50%;
            transform: translateY(-50%);
        }
        #buttons {
            position: absolute;
            top: 95%;
            display: flex;
            justify-content: center;
            width: 100%;
        }
        #buttons div {
            margin: 0 30px;
            font-size: 20px;
            cursor: pointer;
        }

        @media (max-width: 480px) {
            #instructions {
                font-size: 20px;
                top: 50%;
                transform: translateY(-50%);
            }
            #message {
                font-size: 28px;
                top: 50%;
                transform: translateY(-50%);
            }
            #buttons {
                top: 95%;
            }
        }
    </style>
</head>
<body>
    <div id="instructions">Toque para iniciar!</div>
    <div id="message">
        Você perdeu!
        <div id="buttons">
            <div id="continue">Continuar</div>
            <div id="quit">Desistir</div>
        </div>
    </div>
    <canvas id="gameCanvas"></canvas>
    <audio id="bgMusic" src="outravida.mp3" loop></audio>
    <audio id="flapSound" src="flap-sound.mp3"></audio> <!-- Som do flap -->
    <audio id="toySound" src="toy.mp3"></audio> <!-- Som do pássaro ao clicar -->
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const message = document.getElementById("message");
        const instructions = document.getElementById("instructions");
        const bgMusic = document.getElementById("bgMusic");
        const flapSound = document.getElementById("flapSound");
        const toySound = document.getElementById("toySound");
        const continueButton = document.getElementById("continue");
        const quitButton = document.getElementById("quit");
        const birdImage = new Image();
        birdImage.src = "iconsuh.png"; // Caminho para o arquivo do pássaro
        canvas.width = 320;
        canvas.height = 480;

        let bird = { x: 50, y: 200, size: 40, velocity: 0, gravity: 0.05, lift: -3, rotation: 0, rotationDirection: 1 }; // rotationDirection: 1 (direita), -1 (esquerda)
        let pipes = [];
        let frame = 0;
        let gameOver = false;
        let gameStarted = false;
        let obstacleCount = 0;
        let score = 20;
        let gamePaused = false;
        let backgroundColorIndex = 0; // Índice da cor de fundo

        const backgroundColors = [
            "white",        // Branco
            "#87CEEB",      // Azul céu
            "#FFFACD",      // Amarelo claro
            "red"           // Vermelho
        ];

        function resetGame() {
            bird.y = 150;
            bird.velocity = 0;
            bird.rotation = 0;
            bird.rotationDirection = 1; // Inicia com a rotação para a direita
            pipes = [];
            frame = 0;
            gameOver = false;
            obstacleCount = 0;
            score = 20;
            gamePaused = false;
            message.style.display = "none";
            instructions.style.display = "block";
            bgMusic.currentTime = 0;
            bgMusic.pause();
            bgMusic.volume = 0.2; // Volume do bgMusic
            backgroundColorIndex = 0; // Reseta o índice de cor de fundo
        }

        function drawBird() {
            ctx.save();
            ctx.translate(bird.x, bird.y);
            ctx.rotate(bird.rotation * Math.PI / 180);

            // Aplicando a transparência de 20% (80% de opacidade)
            ctx.globalAlpha = 0.8;

            ctx.drawImage(birdImage, -bird.size, -bird.size, bird.size * 2, bird.size * 2);
            ctx.restore();

            // Restaurando a opacidade para 100% após o desenho
            ctx.globalAlpha = 1;
        }

        function drawPipes() {
            ctx.fillStyle = "black";
            pipes.forEach(pipe => {
                ctx.fillRect(pipe.x, 0, pipe.width, pipe.top);
                ctx.fillRect(pipe.x, canvas.height - pipe.bottom, pipe.width, pipe.bottom);
            });
        }

        function drawScore() {
            ctx.fillStyle = "black";
            ctx.font = "40px Arial"; // Tamanho da fonte aumentado
            ctx.fillText("Meta: " + score, 10, 60); // Posicionando o texto mais para cima
        }

        function updateBird() {
            bird.velocity += bird.gravity;
            bird.y += bird.velocity;
            if (bird.y + bird.size / 2 > canvas.height || bird.y - bird.size / 2 < 0) {
                gameOver = true;
            }
        }

        function updatePipes() {
            let gap;
            if (obstacleCount < 10) {
                gap = 240;
            }
            else if (obstacleCount < 15) {
                gap = 200;
            }
            else {
                gap = 180;
            }

            if (frame % 90 === 0) {
                let top = Math.random() * (canvas.height / 2);
                pipes.push({ x: canvas.width, width: 40, top: top, bottom: canvas.height - top - gap });
                obstacleCount++;
            }
            pipes.forEach(pipe => pipe.x -= 2);
            pipes = pipes.filter(pipe => pipe.x + pipe.width > 0);
        }

        function checkCollision() {
            pipes.forEach(pipe => {
                if (bird.x + bird.size / 2 > pipe.x && bird.x - bird.size / 2 < pipe.x + pipe.width) {
                    if (bird.y - bird.size / 2 < pipe.top || bird.y + bird.size / 2 > canvas.height - pipe.bottom) {
                        gameOver = true;
                    }
                }
            });
        }

        function checkScore() {
            pipes.forEach(pipe => {
                if (pipe.x + pipe.width < bird.x && !pipe.passed) {
                    pipe.passed = true;
                    score--;
                    pipe.color = "white";
                } else if (pipe.x + pipe.width >= bird.x) {
                    pipe.color = "black";
                }
            });
        }

        function updateBackgroundColor() {
            // Muda a cor de fundo com base no valor de score
            if (score <= 15 && score > 10) {
                backgroundColorIndex = 1; // Azul céu
            } else if (score <= 10 && score > 5) {
                backgroundColorIndex = 2; // Amarelo claro
            } else if (score <= 5 && score > 0) {
                backgroundColorIndex = 3; // Vermelho
            }
        }

        function rotateBird() {
            const rotationStep = 2; // O pássaro agora gira 2 graus por clique, mais devagar
            bird.rotation += bird.rotationDirection * rotationStep;

            // Limita a rotação para um giro completo (360 graus)
            if (bird.rotation >= 360) {
                bird.rotation = 0;
            }
        }

        function gameLoop() {
            if (gamePaused) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = backgroundColors[backgroundColorIndex]; // Altera a cor de fundo com base no índice
            ctx.fillRect(0, 0, canvas.width, canvas.height); // Aplica o fundo

            if (gameOver || score <= 0) {
                message.style.display = "block";
                gamePaused = true;
                return;
            }

            drawBird();
            drawPipes();
            drawScore();
            updateBird();
            updatePipes();
            checkCollision();
            checkScore();
            updateBackgroundColor(); // Atualiza a cor de fundo
            rotateBird();
            frame++;

            requestAnimationFrame(gameLoop);
        }

        function handleUserInput() {
            if (gamePaused) return;

            if (!gameStarted) {
                gameStarted = true;
                message.style.display = "none";
                instructions.style.display = "none";
                bgMusic.play();
                gameLoop();
            }
            bird.velocity = bird.lift;
            flapSound.currentTime = 0;
            flapSound.play();

            rotateBird(); // Aplica a rotação ao pássaro
            toySound.currentTime = 0; // Reseta o tempo do som
            toySound.volume = 0.1; // Volume do efeito sonoro toy.mp3, metade do volume de outravida.mp3
            toySound.play(); // Reproduz o som do pássaro
        }

        function handleContinue() {
            resetGame();
            gameStarted = false;
        }

        function handleQuit() {
            console.log("Jogo finalizado");
        }

        continueButton.addEventListener("click", handleContinue);
        quitButton.addEventListener("click", handleQuit);

        document.addEventListener("touchstart", handleUserInput);
        document.addEventListener("mousedown", handleUserInput);

        resetGame();
    </script>
</body>
</html>
